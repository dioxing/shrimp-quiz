<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ğŸ¦ æœ‰å¥–ç«çŒœï¼šæˆ‘å¤šä¹…èƒ½åƒå®Œä¸€è¢‹è™¾ï¼Ÿ</title>
  <style>
    :root{
      --primary:#ff7f50;
      --bg:#fff8f3;
      --text:#2c3e50;
      --card:#ffffff;
      --border:#ffe1d2;
      --success:#2ecc71;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      color:var(--text);
      background:linear-gradient(180deg,var(--bg),#fff);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .card{
      width:100%;
      max-width:680px;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      padding:24px;
      box-shadow:0 8px 24px rgba(255,127,80,.15);
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 12px;
      font-size:12px;
      border-radius:999px;
      background:#fff4ee;
      color:#c24e21;
      border:1px solid var(--border);
    }
    h1{
      margin:12px 0 8px;
      font-size:28px;
      line-height:1.2;
      color:#e3622b;
    }
    p.lead{
      margin:0 0 16px;
      color:#5d6d7e;
    }
    .prize{
      margin:12px 0 24px;
      padding:12px 14px;
      background:#f3fff6;
      border:1px solid #d5f5e3;
      border-radius:12px;
      font-weight:600;
      color:#1e8449;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:12px;
      margin:12px 0 8px;
    }
    @media (min-width:520px){
      .grid{ grid-template-columns: repeat(3, 1fr); }
    }
    button.option{
      width:100%;
      padding:14px 12px;
      background:#fff;
      border:1.5px solid var(--border);
      border-radius:12px;
      font-size:16px;
      cursor:pointer;
      transition:all .18s ease;
    }
    button.option:hover{ border-color:var(--primary); transform:translateY(-1px); }
    button.option.active{ border-color:var(--primary); background:#fff6f1; box-shadow:0 6px 16px rgba(255,127,80,.12); }
    .fields{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:16px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .field input, .field textarea{
      border:1.5px solid var(--border);
      border-radius:10px;
      padding:12px 12px;
      font-size:15px;
      outline:none;
    }
    .field input:focus, .field textarea:focus{ border-color:var(--primary); box-shadow:0 0 0 4px rgba(255,127,80,.12); }
    .actions{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:16px;
    }
    .btn{
      padding:12px 16px;
      border:0;
      border-radius:12px;
      font-size:15px;
      cursor:pointer;
    }
    .btn-primary{ background:var(--primary); color:#fff; }
    .btn-ghost{ background:#fff; border:1.5px solid var(--border); }
    .hint{
      font-size:12px;
      color:#7f8c8d;
      margin-top:6px;
    }
    .status{
      margin-top:14px;
      font-size:14px;
      display:none;
    }
    .status.ok{ color:var(--success); display:block; }
    .status.err{ color:#c0392b; display:block; }
    .footer{
      margin-top:18px;
      font-size:12px;
      color:#95a5a6;
      text-align:center;
    }
    .divider{ height:1px; background:var(--border); margin:16px 0; }
  </style>
</head>
<body>
  <main class="card" role="main">
    <div class="badge" aria-label="æ´»åŠ¨ç±»å‹">ğŸ§§ æœ‰å¥–ç«çŒœ</div>
    <h1>çŒœçŒœçœ‹ï¼šæˆ‘å¤šä¹…èƒ½åƒå®Œä¸€è¢‹è™¾ï¼ŸğŸ¦</h1>
    <p class="lead">åœ¨ä¸‹é¢é€‰æ‹©ä½ å¿ƒä¸­çš„ç­”æ¡ˆï¼ˆå‘¨ä¸€ï½å‘¨æ—¥ï¼‰ã€‚æäº¤åå‚ä¸æŠ½å¥–ï¼</p>

    <div class="prize" role="note">
      ğŸ å¥–åŠ±ï¼š<strong>ä¸€è¢‹è™¾ï¼ˆä¸å˜è´¨ç‰ˆï¼‰</strong>
    </div>

    <form id="quizForm" autocomplete="on">
      <div class="grid" role="group" aria-label="é€‰é¡¹">
        <button class="option" type="button" data-value="å‘¨ä¸€">å‘¨ä¸€</button>
        <button class="option" type="button" data-value="å‘¨äºŒ">å‘¨äºŒ</button>
        <button class="option" type="button" data-value="å‘¨ä¸‰">å‘¨ä¸‰</button>
        <button class="option" type="button" data-value="å‘¨å››">å‘¨å››</button>
        <button class="option" type="button" data-value="å‘¨äº”">å‘¨äº”</button>
        <button class="option" type="button" data-value="å‘¨å…­">å‘¨å…­</button>
        <button class="option" type="button" data-value="å‘¨æ—¥">å‘¨æ—¥</button>
      </div>

      <div class="fields">
        <div class="field">
          <label for="nickname">æ˜µç§°ï¼ˆç”¨äºå…¬ç¤ºä¸­å¥–åå•ï¼Œå¯é€‰ï¼‰</label>
          <input id="nickname" name="nickname" placeholder="ä¾‹å¦‚ï¼šå°è™¾ä¾ ">
        </div>
        <div class="field">
          <label for="contact">è”ç³»æ–¹å¼ï¼ˆä»…ç”¨äºå…‘å¥–ï¼Œå¯é€‰ï¼‰</label>
          <input id="contact" name="contact" placeholder="æ‰‹æœºå· / å¾®ä¿¡ / é‚®ç®±">
          <div class="hint">æˆ‘ä»¬åªåœ¨ä½ ä¸­å¥–æ—¶è”ç³»ä½ ï¼›æ•°æ®ä»…ä¿å­˜åœ¨ä½ çš„æµè§ˆå™¨æˆ–ä½ é…ç½®çš„æ¥æ”¶ç«¯ã€‚</div>
        </div>
        <div class="field">
          <label for="remarks">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</label>
          <textarea id="remarks" name="remarks" rows="2" placeholder="æƒ³è¯´ç‚¹å•¥ï¼Ÿ"></textarea>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-primary" type="submit">æäº¤æˆ‘çš„ç«çŒœ</button>
        <button class="btn btn-ghost" type="button" id="exportBtn">å¯¼å‡ºCSV</button>
        <button class="btn btn-ghost" type="button" id="resetBtn" title="æ¸…é™¤æ­¤è®¾å¤‡çš„æäº¤çŠ¶æ€">æ¸…é™¤æœ¬æœºè®°å½•</button>
      </div>
      <div class="status" id="status"></div>
    </form>

    
  </main>

  <script>
    // â€”â€” å¯é€‰ï¼šæŠŠè¿™é‡Œçš„åœ°å€æ”¹æˆä½ çš„æ”¶ä»¶ç«¯ï¼ˆå¦‚ Formspree, è‡ªå»º API, Google Apps Script Web App ç­‰ï¼‰â€”â€”
    const WEBHOOK_URL = ""; // ä¾‹å¦‚ "https://example.com/collect"
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

    const form = document.getElementById('quizForm');
    const exportBtn = document.getElementById('exportBtn');
    const resetBtn = document.getElementById('resetBtn');
    const statusEl = document.getElementById('status');
    const optionButtons = Array.from(document.querySelectorAll('.option'));

    // çŠ¶æ€é”®å
    const STORAGE_KEY_ENTRIES = 'shrimp_quiz_entries_v1';
    const STORAGE_KEY_VOTED = 'shrimp_quiz_voted_v1';

    let selected = null;

    optionButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        optionButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selected = btn.dataset.value;
      });
    });

    function getEntries(){
      try{
        return JSON.parse(localStorage.getItem(STORAGE_KEY_ENTRIES)) || [];
      }catch(e){
        return [];
      }
    }
    function setEntries(entries){
      localStorage.setItem(STORAGE_KEY_ENTRIES, JSON.stringify(entries));
    }

    // ç®€å•é˜²å¤šæŠ•ï¼šåŒä¸€è®¾å¤‡ä»…ä¸€æ¬¡
    function hasVoted(){
      return localStorage.getItem(STORAGE_KEY_VOTED) === '1';
    }
    function markVoted(){
      localStorage.setItem(STORAGE_KEY_VOTED, '1');
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if(!selected){
        showStatus('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé€‰é¡¹ï¼ˆå‘¨ä¸€åˆ°å‘¨æ—¥ï¼‰ã€‚', false);
        return;
      }
      if(hasVoted()){
        showStatus('ä½ å·²åœ¨æœ¬è®¾å¤‡æäº¤è¿‡å•¦ï¼Œæ„Ÿè°¢å‚ä¸ ğŸ§¡', false);
        return;
      }
      const nickname = document.getElementById('nickname').value.trim();
      const contact = document.getElementById('contact').value.trim();
      const remarks = document.getElementById('remarks').value.trim();
      const timestamp = new Date().toISOString();

      const entry = { day:selected, nickname, contact, remarks, timestamp };

      // 1) å­˜æœ¬åœ°
      const entries = getEntries();
      entries.push(entry);
      setEntries(entries);
      markVoted();

      // 2) å¯é€‰ï¼šå‘é€åˆ°ä½ çš„åå°/è¡¨å•
      let remoteOK = true;
      if(WEBHOOK_URL){
        try{
          const res = await fetch(WEBHOOK_URL, {
            method:'POST',
            headers:{ 'Content-Type':'application/json' },
            body:JSON.stringify(entry)
          });
          remoteOK = res.ok;
        }catch(err){
          remoteOK = false;
        }
      }

      // 3) åé¦ˆ
      optionButtons.forEach(b => b.disabled = true);
      e.target.querySelector('button[type="submit"]').disabled = true;

      showStatus(remoteOK ? 'æäº¤æˆåŠŸï¼ç¥ä½ å¥½è¿ï½' : 'å·²æäº¤ï¼ˆæœ¬åœ°ä¿å­˜ï¼‰ã€‚è¿œç«¯åŒæ­¥å¤±è´¥å¯ç¨åå†è¯•ã€‚', true);
    });

    // CSV å¯¼å‡º
    exportBtn.addEventListener('click', () => {
      const entries = getEntries();
      if(entries.length === 0){
        showStatus('å½“å‰æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®ã€‚', false);
        return;
      }
      const header = ['day','nickname','contact','remarks','timestamp'];
      const rows = entries.map(e => [e.day, e.nickname, e.contact, e.remarks, e.timestamp]);
      const csv = [header, ...rows].map(r => r.map(escapeCSV).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'shrimp_quiz_entries.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showStatus('å·²å¯¼å‡º CSVã€‚', true);
    });

    // æ¸…é™¤æœ¬æœºçŠ¶æ€ï¼ˆä¾¿äºæµ‹è¯•ï¼‰
    resetBtn.addEventListener('click', () => {
      localStorage.removeItem(STORAGE_KEY_VOTED);
      // ä¸æ¸… entriesï¼Œé¿å…è¯¯åˆ ï¼›å¦‚éœ€æ¸…ç©ºå…¨éƒ¨æ•°æ®è§ä¸‹ï¼š
      // localStorage.removeItem(STORAGE_KEY_ENTRIES);
      optionButtons.forEach(b => { b.disabled=false; b.classList.remove('active'); });
      form.querySelector('button[type="submit"]').disabled = false;
      selected = null;
      showStatus('å·²æ¸…é™¤æœ¬æœºæäº¤çŠ¶æ€ã€‚', true);
    });

    function showStatus(msg, ok){
      statusEl.textContent = msg;
      statusEl.className = 'status ' + (ok ? 'ok':'err');
    }

    function escapeCSV(val){
      if(val==null) return '';
      const s = String(val).replace(/\r?\n/g,' ');
      if(/[",]/.test(s)) return '"' + s.replace(/"/g,'""') + '"';
      return s;
    }
  </script>
</body>
</html>
